<div class="row-fluid">
<div class="span4">
	<div id="theForum" class="form-horizontal">
	</div>
</div>
<div class="span8">
<iframe src="parameter_descriptions.html" frameBorder="0">
Your browser doesn't support iframes.
</iframe>
</div>
	<script type="text/javascript">
		var form = "";
		$.get("Form.xml", function(data) {
			var xml = $($.parseXML(data));
			xml.find('Group').each(function() {
				//Traverse the xml tree
				var groupID = "";
				var id = $(this).attr("id");
				form += "<h3>" + id + "</h3>";
				
				//Access field tags
				$(this).find('Fields').find('Field').each(function() {
					id = $(this).attr("id");
					var label = $(this).attr("label");
					var type = $(this).attr("type");
					var toolTip = $(this).attr("toolTip");
					var value = $(this).text().replace(/\s/g, "");
					
					if (type == 'text') {
						form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
							+ "<a class=\"link\" data-original-title=\"" + toolTip 
							+ "\"><label class=\"control-label\" for=\"" + id + "\">" + label + "</label>"
							+ "<div class=\"controls\">"
							+ "<input id=\"" + id + "\" type=\"text\" value=\""+ value + "\">"
							+ "</div>"
							+ "</div></a>";
					}
					else if (type == "select" || type == "toggle") {
						if (type == "toggle") {
							groupID = id;
						}
						form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
						+ "<a class=\"link\" data-original-title=\"" + toolTip 
						+ "\"><label class=\"control-label\" for=\"" + id + "\">" + label + "</label>"
						+ "<div class=\"controls\">";
						form += "<select id=\"" + id + "\">";
						$(this).find("Options").find("Option").each(function() {
							label = $(this).attr("label");
							value = $(this).text().replace(/\s/g, "");
							form += "<option value=\"" + value + "\">" + label + "</option>";
						})
						form += "</select>"
							 + "</div>"
							 + "</div></a>";
	
						if (type=="toggle") {
							form += "<div id=\"" + groupID + "-toggle\">";
							$(this).find('Hidable').find('HField').each(function() {
								id = $(this).attr("id");
								var label = $(this).attr("label");
								var type = $(this).attr("type");
								var toolTip = $(this).attr("toolTip");
								var value = $(this).text().replace(/\s/g, "");
								
								form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
									+ "<a class=\"link\" data-original-title=\"" + toolTip
									+ "\"><label class=\"control-label\" for=\"" + id + "\">"
									+ label + "</label>"
									+ "<div class=\"controls\">"
									+ "<input id=\"" + id + "\" type=\"text\" value=\""+ value + "\">"
									+ "</div>"
									+ "</div></a>";
							});
							form += "</div> </br>"
								  + "<script>"
								  + "$(\"#" + groupID + "\").change(function() {"
								  + "$('#" + groupID + "-toggle').toggle(this.value == 'True');"
							 	  + "});"
							 	  + "$('#" + groupID + "-toggle').toggle();"
							 	  + "<\/script>";
							 	  
							 	  
						}
					}
					
				});
			});
			form += "</br><center><button type=\"submit\" class=\"btn btn-success\" "
			+ "onClick=\"submitForm()\">Submit</button></center>";
			$("#theForum").append(form);
			$(".link").tooltip();
		}, 'text');
		
		
		
		function submitForm() {
			var dic = "";
			$.get("Form.xml", function(data) {
				var xml = $($.parseXML(data));
				xml.find('Group').each(function() {
					//Traverse the xml tree
					//Access field tags
					$(this).find('Fields').find('Field').each(function() {
	
						var id = $(this).attr("id");
						var type = $(this).attr("type");
						if( type != "toggle") {
							if(type == "select") {
								var value = $("#" + id).val().replace(/\s/g, "");
							}
							else {
								var value = $("#" + id).val().replace(/\s/g, "");
							}
							dic += "\"" + id + "\":\"" + value + "\",";
						}
						else {
							var value = $(this).text().replace(/\s/g, "");
							if(value == 'True') {
								$(this).find('Hidable').find('HField').each(function() {
									id = $(this).attr("id");
									value = $("#" + id).val().replace(/\s/g, "");
									dic += "\"" + id + "\":\"" + value + "\",";
								});
							}
						}
					});
				});
				// cutoff the last comma
				dic = dic.substring(0, dic.length - 1);
				
				$.ajax({
					url: '../../query', 
					data: dic,
					success: parseResponse,
				});
			}, "text");
		}
	
		function parseResponse(data) {
			data = $.parseJSON(data);
			toRet = "<div class=\"span1\"></div>";
			toRet += "<div class=\"span10\"><h1>Results:</h1>";
			//Grab important keys
			params = data["params"];
			sensors = data['sensors'];
			stats = data['stats'];
			filenames = data['filenames'];
			
			//Re-Print params
			toRet += "<h3>Parameters:</h4>";
			for(key in params) {
				toRet += "<b>" + key + "</b>" + ": " + params[key] + "</br>";
			}
			
			toRet += "<h3>Stats:</h4>";
			for(key in stats) {
				if(key != "acousticCoverage") {
					toRet +="<b>" + key + "</b>" +  ": " + stats[key] + "</br>";
				}
			}
			
			toRet += "<h3>Graphs:</h4>";
			for(key in filenames) {
				//if(key.indexOf(".txt") != -1)) {
					toRet += "<image src=\"../" + filenames[key] + "\"></image>";
				//}
				//if(key.indexOf(".zip") != -1)) {
				//	toRet += "<a href=\"" + filenames[key] + "\">Download a zipped copy of all results</a>";
				//}
			}
			
			toRet += "</br><center><button type=\"submit\" class=\"btn btn-danger\" onClick=\"location.reload()\"> < Back</button></center>";
			toRet += "</div><div class=\"span1\"></span>";
			$('#content').html(toRet);
		}
	</script>
</div>