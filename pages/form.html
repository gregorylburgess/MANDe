<div class="span12">
	<div id="theForum" class="form-horizontal">

	</div>
</div>

<script>
	var form = "";
	$.get("form.xml", function(data) {
		var xml = $($.parseXML(data));
		xml.find('Group').each(function() {
			//Traverse the xml tree
			var groupID = "";
			var id = $(this).attr("id");
			form += "<h3>" + id + "</h3>";
			
			//Access field tags
			$(this).find('Fields').find('Field').each(function() {
				id = $(this).attr("id");
				var label = $(this).attr("label");
				var type = $(this).attr("type");
				var toolTip = $(this).attr("toolTip");
				var value = $(this).text().replace(/\s/g, "");
				
				if (type == 'text') {
					form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
						+ "<a class=\"link\" data-original-title=\"" + toolTip + "\"><label class=\"control-label\" for=\"" + id + "\">" + label + "</label>"
						+ "<div class=\"controls\">"
						+ "<input id=\"" + id + "\" type=\"text\" value=\""+ value + "\">"
						+ "</div>"
						+ "</div></a>";
				}
				else if (type == "select" || type == "toggle") {
					if (type == "toggle") {
						groupID = id;
					}
					form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
					+ "<a class=\"link\" data-original-title=\"" + toolTip + "\"><label class=\"control-label\" for=\"" + id + "\">" + label + "</label>"
					+ "<div class=\"controls\">";
					form += "<select id=\"" + id + "\">";
					$(this).find("Options").find("Option").each(function() {
						label = $(this).attr("label");
						value = $(this).text().replace(/\s/g, "");
						form += "<option value=\"" + value + "\">" + label + "</option>";
					})
					form += "</select>"
						 + "</div>"
						 + "</div></a>";

					if (type=="toggle") {
						form += "<div id=\"" + groupID + "-toggle\">";
						$(this).find('Hidable').find('HField').each(function() {
							id = $(this).attr("id");
							var label = $(this).attr("label");
							var type = $(this).attr("type");
							var toolTip = $(this).attr("toolTip");
							var value = $(this).text().replace(/\s/g, "");
							
							form += "<div id=\"" + id + "-cg\" class=\"control-group\">" 
								+ "<a class=\"link\" data-original-title=\"" + toolTip + "\"><label class=\"control-label\" for=\"" + id + "\">" + label + "</label>"
								+ "<div class=\"controls\">"
								+ "<input id=\"" + id + "\" type=\"text\" value=\""+ value + "\">"
								+ "</div>"
								+ "</div></a>";
						});
						form += "</div> </br>"
							  + "<script>"
							  + "$(\"#" + groupID + "\").change(function() {"
							  + "$('#" + groupID + "-toggle').toggle(this.value == 'True');"
						 	  + "});"
						 	  + "$('#" + groupID + "-toggle').toggle();"
						 	  + "<\/script>";
						 	  
						 	  
					}
				}
				
			});
		});
		form += "</br><button type=\"submit\" class=\"btn\" onClick=\"submitForm()\">Submit</button>";
		$("#theForum").html(form);
		$(".link").tooltip();
	}, 'text');
	
	
	
	function submitForm() {
		var dic = "";
		for(field in fields) {
			name = fields[field];
			value = $("#" + name).val();
			dic += "\"" + name + "\":\"" + value + "\",";
		}
		// cutoff the last comma
		dic = dic.substring(0, dic.length - 1);

		$.ajax({
			url: '../../query', 
			data: dic,
			success: parseResponse,
		});
	}

	function parseResponse(data) {
		data = $.parseJSON(data);
		toRet = "<h1>Results:</h1>";
		//Grab important keys
		params = data["params"];
		sensors = data['sensors'];
		stats = data['stats'];
		filenames = data['filenames'];
		
		//Re-Print params
		toRet += "<h3>Parameters:</h4>";
		for(key in params) {
			toRet += "<b>" + key + "</b>" + ": " + params[key] + "</br>";
		}
		
		toRet += "<h3>Stats:</h4>";
		for(key in stats) {
			toRet +="<b>" + key + "</b>" +  ": " + stats[key] + "</br>";
		}
		
		toRet += "<h3>Graphs:</h4>";
		for(key in filenames) {
			toRet += "<image src=\"../" + filenames[key] + "\"></image>";
		}
		$('#theForum').html(toRet);
	}
</script>